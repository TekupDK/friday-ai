# Cursor AI Rules - Friday AI Chat

This file contains rules and guidelines for Cursor AI to follow when assisting with Friday AI Chat development.

## Project Context

Friday AI Chat is a business automation platform for TekupDK (Rendetalje.dk cleaning company) built with:
- **Frontend:** React 19 + TypeScript + Tailwind CSS 4 + shadcn/ui
- **Backend:** Express 4 + tRPC 11 + Drizzle ORM
- **Database:** MySQL/TiDB
- **AI:** Gemini 2.5 Flash, Claude 3.5 Sonnet, GPT-4o
- **Integrations:** Google Workspace (Gmail, Calendar), Billy.dk (accounting)

## Code Style

### TypeScript

- **Always use TypeScript** - No plain JavaScript files
- **Strict mode enabled** - All types must be explicitly defined
- **Use `type` for simple types, `interface` for objects**
- **Prefer `const` over `let`, never use `var`**
- **Use template literals** for string interpolation

**Example:**
```typescript
// Good
const userName: string = `Hello, ${user.name}`;
type Status = "pending" | "completed";
interface User {
  id: number;
  name: string;
}

// Bad
var userName = "Hello, " + user.name;
let status: any = "pending";
```

### React Components

- **Use functional components** - No class components
- **Use hooks** - `useState`, `useEffect`, `useMemo`, `useCallback`
- **Extract custom hooks** for reusable logic
- **Props interface** - Always define props type

**Example:**
```typescript
// Good
interface Props {
  title: string;
  onSubmit: (value: string) => void;
}

export default function MyComponent({ title, onSubmit }: Props) {
  const [value, setValue] = useState("");
  return <div>{title}</div>;
}

// Bad
export default function MyComponent(props: any) {
  return <div>{props.title}</div>;
}
```

### Naming Conventions

| Type | Convention | Example |
|------|------------|---------|
| Files | `kebab-case.tsx` or `PascalCase.tsx` | `user-profile.tsx`, `UserProfile.tsx` |
| Components | `PascalCase` | `UserProfile` |
| Functions | `camelCase` | `getUserById` |
| Variables | `camelCase` | `userName` |
| Constants | `UPPER_SNAKE_CASE` | `MAX_RETRIES` |
| Types/Interfaces | `PascalCase` | `User`, `UserProfile` |
| Database columns | `camelCase` | `createdAt`, `userId` |

### Import Order

```typescript
// 1. External libraries
import { useState } from "react";
import { z } from "zod";

// 2. Internal components
import ChatPanel from "@/components/ChatPanel";

// 3. UI components
import { Button } from "@/components/ui/button";

// 4. Utilities and hooks
import { trpc } from "@/lib/trpc";
import { useAuth } from "@/hooks/useAuth";

// 5. Types and constants
import type { User } from "@/types";
import { APP_TITLE } from "@/const";
```

## File Structure Rules

### DO NOT EDIT

- `client/src/_core/` - Framework code managed by Manus
- `server/_core/` - OAuth, context, server setup

### EDIT FREELY

- `client/src/components/` - UI components
- `client/src/pages/` - Page components
- `server/*.ts` - Business logic and API endpoints
- `drizzle/schema.ts` - Database schema

### File Organization

**Backend:**
- `server/routers.ts` - Main tRPC router (keep under 200 lines)
- `server/db.ts` - Database helpers for core tables
- `server/*-db.ts` - Feature-specific database helpers
- `server/*-router.ts` - Feature-specific tRPC routers
- `server/*-actions.ts` - Business logic and actions

**Frontend:**
- `client/src/pages/*.tsx` - Top-level page components
- `client/src/components/*.tsx` - Shared components
- `client/src/components/inbox/*.tsx` - Inbox tab components
- `client/src/components/ui/*.tsx` - shadcn/ui components (auto-generated)

## Database Schema Rules

### Column Naming

- **Use camelCase** - Matches TypeScript naming
- **Avoid abbreviations** - Use full words
- **Use descriptive names** - `createdAt` not `created`

**Example:**
```typescript
// Good
export const users = mysqlTable("users", {
  id: int("id").autoincrement().primaryKey(),
  createdAt: timestamp("createdAt").defaultNow().notNull(),
  lastSignedIn: timestamp("lastSignedIn").defaultNow().notNull(),
});

// Bad
export const users = mysqlTable("users", {
  id: int("id").autoincrement().primaryKey(),
  created_at: timestamp("created_at").defaultNow().notNull(),
  last_login: timestamp("last_login").defaultNow().notNull(),
});
```

### Table Design

- **Always include `id` primary key** - Auto-increment integer
- **Always include `createdAt` timestamp** - Track creation time
- **Include `updatedAt` for mutable tables** - Track last update
- **Use `userId` for user-owned data** - Foreign key to users table

### Type Exports

```typescript
export const users = mysqlTable("users", { ... });
export type User = typeof users.$inferSelect;
export type InsertUser = typeof users.$inferInsert;
```

## tRPC API Rules

### Procedure Structure

```typescript
// Query (GET)
procedureName: protectedProcedure
  .input(z.object({ ... }))
  .query(async ({ ctx, input }) => {
    return await getData(ctx.user.id, input);
  }),

// Mutation (POST/PUT/DELETE)
procedureName: protectedProcedure
  .input(z.object({ ... }))
  .mutation(async ({ ctx, input }) => {
    const result = await updateData(ctx.user.id, input);
    return { success: true, data: result };
  }),
```

### Input Validation

- **Always use Zod schemas** for input validation
- **Use `.min()`, `.max()`, `.email()` etc.** for constraints
- **Make optional fields explicit** with `.optional()`

**Example:**
```typescript
const createLeadInput = z.object({
  name: z.string().min(1).max(255),
  email: z.string().email(),
  phone: z.string().optional(),
  source: z.string(),
});
```

### Error Handling

```typescript
import { TRPCError } from "@trpc/server";

// Throw appropriate error codes
throw new TRPCError({
  code: "UNAUTHORIZED",  // 401
  message: "You must be logged in",
});

throw new TRPCError({
  code: "NOT_FOUND",  // 404
  message: "Resource not found",
});

throw new TRPCError({
  code: "BAD_REQUEST",  // 400
  message: "Invalid input",
});
```

## Frontend Patterns

### tRPC Hooks

```typescript
// Query
const { data, isLoading, error } = trpc.leads.list.useQuery();

// Mutation with invalidation
const createMutation = trpc.leads.create.useMutation({
  onSuccess: () => {
    trpc.useUtils().leads.list.invalidate();
    toast.success("Lead created");
  },
  onError: (error) => {
    toast.error(error.message);
  },
});

await createMutation.mutateAsync({ name: "John" });
```

## Cursor AI Behavior

When assisting with Friday AI Chat development:

1. **Read existing code** before suggesting changes
2. **Follow established patterns** in the codebase
3. **Suggest TypeScript types** for all functions
4. **Provide complete code blocks** - No placeholders like `// ... rest of code`
5. **Explain trade-offs** when multiple approaches exist
6. **Reference documentation** (ARCHITECTURE.md, API_REFERENCE.md, DEVELOPMENT_GUIDE.md, docs/*.md files)
7. **Check for errors** before suggesting code
8. **Update TODO.md** when adding features
9. **Maintain consistency** with existing code style
10. **Read and reference relevant .md documentation files** in the project before making changes

## Documentation Files Reference

Always check these documentation files for context:
- `docs/ARCHITECTURE.md` - System architecture
- `docs/DEVELOPMENT_GUIDE.md` - Development workflow
- `docs/API_REFERENCE.md` - API documentation
- `README.md` - Project overview
- `START_GUIDE.md` - Quick start guide
- All files in `docs/` directory for feature-specific documentation

---

**Last Updated:** January 28, 2025
**Maintained by:** TekupDK Development Team

