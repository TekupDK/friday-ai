# Friday AI Chat - Development Dockerfile
# Supports hot-reload and development workflow
# Optimized for fast builds - uses volume mounts for source code

FROM node:22-alpine

WORKDIR /app

# Install pnpm
RUN npm install -g pnpm@10.20.0

# Install development dependencies
RUN apk add --no-cache git

# Copy ONLY package files first (for better caching)
COPY package.json pnpm-lock.yaml ./

# Install dependencies (including dev dependencies)
# This layer will be cached unless package files change
RUN pnpm install --frozen-lockfile

# Copy minimal required files (rest comes via volume mounts)
COPY server/_core ./server/_core
COPY shared ./shared
COPY drizzle ./drizzle
COPY check-env.js ./

# Expose port
EXPOSE 3000

# Development command with hot-reload
# Uses tsx watch for automatic reloading on file changes
# Source code is mounted as volume, so no need to copy everything
CMD ["pnpm", "dev"]

