# Friday AI Chat - Development Dockerfile
# Supports hot-reload and development workflow
# Optimized for fast builds - uses volume mounts for source code

FROM node:22-alpine

WORKDIR /app

# Install pnpm
RUN npm install -g pnpm@10.20.0

# Install development dependencies
RUN apk add --no-cache git

# Copy ONLY package files first (for better caching)
COPY package.json ./
COPY pnpm-lock.yaml ./
COPY patches ./patches

# Install dependencies (including dev dependencies)
# This layer will be cached unless package files change
# Note: If pnpm-lock.yaml exists, it should be copied separately for --frozen-lockfile
RUN pnpm install

# Copy minimal required files (rest comes via volume mounts for hot-reload)
# These are fallbacks - actual source is mounted as volumes
COPY server/_core ./server/_core
COPY shared ./shared
COPY drizzle ./drizzle
COPY check-env.js ./
COPY tsconfig.json ./

# Expose ports (backend and frontend)
EXPOSE 3000 5173

# Development command with hot-reload
# Uses tsx watch for automatic reloading on file changes
# Source code is mounted as volume, so no need to copy everything
# Default command runs backend - frontend uses override in docker-compose
CMD ["pnpm", "dev"]

